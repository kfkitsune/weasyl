$def with (username, tfa_secret, qrcode, error)
$:{RENDER("common/stage_title.html", ["Enable 2FA: Step 1", "Two-Factor Authentication", "Settings"])}

<div class="content form clear">
  <form method="POST" class="form skinny clear" action="/control/2fa/init">
    $if error == "password":
      <div id="signin_error"><strong>Whoops!</strong> You entered an incorrect password.</div>
    $elif error == "2fa":
      <div id="signin_error"><strong>Whoops!</strong> The 2FA response token you provided did not validate.</div>
    <h3>Two-Factor Authentication</h3>
    <p><strong>Username: $:{username}</strong></p>
    <p>
      You are about to enable Two-Factor Authentication (2FA) for the Weasyl account identified above.
      You will need a compatible app such as Google Authenticator to generate time-based tokens
      each time you log into your Weasyl account.
    </p>
    <p>
      Upon successful verification, you will be provided with ten recovery codes. <strong>Print these
      codes, and secure them as you would your password.</strong> In the event you lose access to your
      authenticator app, you will need these codes to regain access to your Weasyl account. Recovery
      codes can be refreshed at any time from your settings page.
    </p>
    <p>
      <strong>Warning:</strong> For security reasons, Weasyl staff will be unable to assist you if
      you lose access to your recovery codes. We advise never using more than eight codes, as you will
      need two to disable two-factor authentication from a logged-out state (one code to log in, one
      code to disable 2FA).
      <br />
      As a precaution against being locked out your account if all recovery codes are used, 2FA will
      automatically be disabled if--and only if--all recovery codes are consumed. Generating a new
      set of codes will prevent this from occurring. If this occurs, you will need to set-up 2FA again.
    </p>
    <h3>Confirm your Password</h3>
      <label for="login-pass">Password</label>
      <input type="password" id="login-pass" class="input" name="password" placeholder="Password" required />
    <h3>Scan with Google Authenticator...</h3>
    <div>
      <img src="data:image/svg+xml;utf8,${qrcode}">
    </div>
    <h3>... or manually enter your secret key</h3>
    <p>
      Your TOTP key is: ${tfa_secret}
    </p>
    <label for="tfa-init-verify">Enter 2FA token</label>
    <input type="text" id="tfa-init-verify" maxlength="6" name="tfaresponse" placeholder="012345" autocomplete="off" required />

    <input type="hidden" value="${tfa_secret}" name="tfasecret" />
    $:{CSRF()}

    <div style="padding-top: 1em;">
      <button class="button negative" name="action" value="cancel">Cancel</button>
      <button class="button positive" name="action" value="continue">Continue</button>
    </div>
  </form>
</div>
